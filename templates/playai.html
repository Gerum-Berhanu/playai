<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/static/imgs/robot.png" type="image/x-icon">
    <link rel="stylesheet" href="/static/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/playai.css">
    <title>PlayAI</title>
</head>

<body class="vh-100 d-flex flex-column">
    <div class="container-fluid flex-grow-1 bg-gradient-darklime d-flex justify-content-start align-items-center flex-column">
        <img src="/static/imgs/robot.png" class="my-5" alt="PlayAI Picture" width="100px">
        <form id="prompt-form" class="col-sm-6 col-12 mb-5 d-flex">
            <input type="text" name="prompt" id="prompt" class="p-3 flex-grow-1 form-control" placeholder="Ask PlayAI"
                required>
            <button type="submit" id="send" class="border border-2 border-white">
                <img src="/static/imgs/send_fancy.svg" class="p-3" alt="Send" width="56.25">
            </button>
        </form>
        <div class="response-container">
            <div id="response" class="text-white">The response will be displayed here...</div>
        </div>
    </div>

    <script>
        const form = document.getElementById("prompt-form");
        const promptInput = document.getElementById("prompt");
        const response = document.getElementById("response");

        form.addEventListener("submit", async event => {
            event.preventDefault();
            response.textContent = "";
            response.classList.add("loader");
            const formData = new FormData(form);

            try {
                const resp = await fetch("/ask", {
                    method: "POST",
                    body: formData
                });
                if (!resp.ok) throw new Error("Failed to receive response from PlayAI!");
                const data = await resp.json();

                response.classList.remove("loader");
                promptInput.value = "";

                console.log(data.answer);

                for (const text of data.answer) {
                    // const newPara = document.createElement("p")
                    // newPara.classList.add("response-paragraph")
                    // response.appendChild(newPara)
                    response.innerHTML = data.answer

                    // await typeText(text, response.lastElementChild)
                }
            } catch (err) {
                response.classList.remove("loader");
                response.textContent = "Oops! Something went wrong!";
                console.log("ERROR", err);
            }
        });

        async function typeText(text, element) {
            for (let i = 0; i < text.length; i++) {
                element.textContent += text[i];
                await new Promise(resolve => setTimeout(resolve, 25)); // Adjust the speed by changing the delay (in milliseconds)
            }
        }

    </script>
    <script src="/static/bootstrap.bundle.min.js"></script>
</body>

</html>